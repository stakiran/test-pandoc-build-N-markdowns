<h2 id="scrapboxでページを1件ずつ計n件分取得する実験">Scrapboxでページを1件ずつ計n件分取得する実験</h2>
<ul>
<li>全ページの内容を全部parseする ← これたぶん無理
<ul>
<li>できるけど 3000page の fetch になるから実質無理</li>
<li>ちょっとコード書いて時間計測してみよう、案外一瞬かもしんねえ</li>
<li>n=30
<ul>
<li><a href="https://gyazo.com/34833f44756bdc4cfd641a21388822f7" target="_blank" rel="noopener noreferrer"><img src="https://gyazo.com/34833f44756bdc4cfd641a21388822f7/raw" /></a></li>
<li>12秒くらいだった</li>
<li>3000だと単純計算で1200秒</li>
<li>論外</li>
</ul></li>
</ul></li>
<li><a href="thk.md">thk</a> <a href="https://scrapbox.io/takker">/takker</a>
<ul>
<li><span class="citation">[/villagepump/@sta#6012cb151280f0000057ddc2]</span>(https://scrapbox.io/villagepump/<span class="citation">@sta#6012cb151280f0000057ddc2</span>)</li>
<li><code>Promise.all()</code></li>
<li>ブラウザ激重くなりそうな気がしないでもない</li>
<li>10, 1000, 1000, 3000 同時くらいで実験
<ul>
<li><a href="https://scrapbox.io/takker/scrapboxの全てのpageを取得する">/takker/scrapboxの全てのpageを取得する</a></li>
<li>サーバーに負担かかる問題があるもよう</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ページ内容全件取得</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// fetch で一件ずつ取る案</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 遅すぎて論外</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">const pages = scrapbox.Project.pages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">const pageTitles = []</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">for(const page of pages){</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"> const doesNotExists = page.exists == false</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"> if(doesNotExists){</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">  continue</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"> }</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"> const title = page.title</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"> pageTitles.push(title)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">const getter = (pageTitle) =&gt; {</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">    return fetch(`/api/pages/sta/${pageTitle}/text`).then((res) =&gt; {</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">     return res.text()</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">    }).then((text) =&gt; {</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">     const textByStr= text</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">     const textByLines = text.split(LB)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">     return textByLines</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">    })</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">}</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">let c = 0</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">async function けいそくする(count){</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">  console.log(`けいそく すたーと with ${count}`)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">    for(let i=0; i&lt;count; i++){</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">     const pageTitle = pageTitles[i]</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">     c += 1</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">     await getter(pageTitle)</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">    }</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">    console.log(&#39;けいそく ＼(^o^)／&#39;)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">} </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">けいそくする(30)</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>
<p><br></p>
<h2 id="links">Links</h2>
<ul>
<li>← <a href="scrapbox-dailytasklist-impls.md">scrapbox-dailytasklist-impls</a></li>
</ul>
<h2 id="hop-links">2hop Links</h2>
<ul>
<li>→ <a href="thk.md">thk</a>
<ul>
<li>← <a href="このScrapbox固有の表記.md">このScrapbox固有の表記</a></li>
<li>← <a href="知的生産は個人的なものである、の考察残骸.md">知的生産は個人的なものである、の考察残骸</a></li>
<li>← <a href="新奇開拓のジレンマ.md">新奇開拓のジレンマ</a></li>
</ul></li>
</ul>
