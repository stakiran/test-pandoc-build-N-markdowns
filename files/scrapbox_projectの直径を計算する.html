<h2 id="scrapbox-projectの直径を計算する">scrapbox projectの直径を計算する</h2>
<p><a href="https://scrapbox.io/villagepump/井戸端の直径">/villagepump/井戸端の直径</a></p>
<ul>
<li>コードリーディングしたい</li>
</ul>
<p><br></p>
<ul>
<li>links</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>links <span class="op">=</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;title1&quot;</span><span class="op">:</span> links1<span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;title2&quot;</span><span class="op">:</span> links2<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>…
<ul>
<li>たぶんこうなってる
<ul>
<li>fromEntriesは <code>[key,value](key,value.md)</code> を <code>{ key:value}</code> に変換している</li>
<li><a href="https://zenn.dev/terrierscript/articles/2021-04-02-java-script-object-entities">JavaScriptでObject.entries/fromEntriesでreduceの利用頻度を減らす</a></li>
</ul></li>
<li>links？
<ul>
<li><a href="https://scrapbox.io/scrapboxlab/api/pages/:projectname/search/titles">/scrapboxlab/api/pages/:projectname/search/titles</a></li>
<li>ページ内のリンク（たぶんリンク先ページ名）</li>
</ul></li>
<li>つまり links_per_title</li>
</ul></li>
<li><code>for (const p in links)</code>
<ul>
<li>for in ってなんだっけ
<ul>
<li>p に key が入る</li>
<li>つまり<code>for (const title in links_per_title)</code></li>
</ul></li>
</ul></li>
<li><code>links[p].forEach(l =&gt; {</code> の部分
<ul>
<li><code>links[p]</code> は、<code>links = links_per_title[title](p]</code>_は、<code>links_=_links_per_title[title.md)</code> のことだな</li>
<li><code>l</code> には、今見てる title の links の各値（つまりページtitleのリンク先ページ名）が来る</li>
<li><code>links[l]</code>
<ul>
<li>これは <code>links_per_title[l]</code></li>
</ul></li>
</ul></li>
<li>うー、コード書き換えながら見ていくべきだな</li>
</ul>
<p><br></p>
<p>2021/05/15 時点の元コードから<a href="机上リファクタリング.md">机上リファクタリング</a>している</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="kw">async</span> ({<span class="dt">data</span><span class="op">:</span> project}) <span class="kw">=&gt;</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> diameter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> diameterList<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> links_per_titles <span class="op">=</span> <span class="cf">await</span> <span class="fu">getLinkInfo</span>(project)<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> title <span class="kw">in</span> links_per_titles) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// p: 距離を測る元ページのタイトル</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> visited <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> distList <span class="op">=</span> [[[]<span class="op">,</span> title]]<span class="op">;</span>  <span class="co">// 辿ったページリストと現在のページのペア（=経路）のリスト</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> depth <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> nextList <span class="op">=</span> []<span class="op">;</span>  <span class="co">// titleから1歩進んだ経路のリスト</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>   distList<span class="op">.</span><span class="fu">forEach</span>(([pred<span class="op">,</span> title]) <span class="kw">=&gt;</span> {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    links_per_titles[title]<span class="op">.</span><span class="fu">forEach</span>(linkto_title_of_this <span class="kw">=&gt;</span> {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>     <span class="co">// pのリンク先の各ページを見る</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> this_linkto_exists <span class="op">=</span> (links_per_titles[linkto_title_of_this] <span class="op">===</span> <span class="kw">undefined</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (not this_linkto_exists) {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>     already_visited <span class="op">=</span> visited<span class="op">.</span><span class="fu">has</span>(linkto_title_of_this)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(already_visited){</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">continue</span><span class="op">;</span> <span class="co">// forEachの中でcontinueってできるんだっけ？（できるとみなす）</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>     <span class="co">// 未訪問なら1歩進んだ経路を追加する</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>     visited<span class="op">.</span><span class="fu">add</span>(linkto_title_of_this)<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>     <span class="co">// ★predって何の略？</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>     <span class="co">// ...ってなんだっけ？ → pythonでいう *args や</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>     <span class="co">// とりあえず pred は最初は [] だから、newpred も [] やな</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>     <span class="kw">const</span> newPred <span class="op">=</span> [<span class="op">...</span>pred]<span class="op">;</span> <span class="co">// copy</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>     newPred<span class="op">.</span><span class="fu">push</span>(title)<span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>     nextList<span class="op">.</span><span class="fu">push</span>([newPred<span class="op">,</span> linkto_title_of_this])<span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>     <span class="co">// ★次読むなら、この二周目以降から</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>   })<span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (nextList<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 行き止まり</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>   <span class="co">// 現在の経路リストを更新して繰り返す</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>   distList <span class="op">=</span> nextList<span class="op">;</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>   depth<span class="op">++;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 今までで最長の経路なら、経路長と経路の中身の記録を更新</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newDist <span class="op">=</span> depth <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (newDist <span class="op">&gt;</span> diameter) {</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>   diameter <span class="op">=</span> newDist<span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>   diameterList <span class="op">=</span> [<span class="op">...</span>distList[<span class="dv">0</span>][<span class="dv">0</span>]<span class="op">,</span> distList[<span class="dv">0</span>][<span class="dv">1</span>]]<span class="op">;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    self<span class="op">.</span><span class="fu">postMessage</span>(diameterList)<span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">// 全ページのリンク情報を取得</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">getLinkInfo</span>(project <span class="op">=</span> scrapbox<span class="op">.</span><span class="at">Project</span><span class="op">.</span><span class="at">name</span>) {</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>   <span class="kw">const</span> rawPages <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>   <span class="kw">let</span> followingId <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>   <span class="cf">do</span> {</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> param <span class="op">=</span> followingId <span class="op">===</span> <span class="kw">null</span> <span class="op">?</span> <span class="st">&#39;&#39;</span> <span class="op">:</span> <span class="vs">`?followingId=</span><span class="sc">${</span>followingId<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> res <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>     <span class="vs">`https://scrapbox.io/api/pages/</span><span class="sc">${</span>project<span class="sc">}</span><span class="vs">/search/titles</span><span class="sc">${</span>param<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    followingId <span class="op">=</span> res<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;X-Following-Id&#39;</span>)<span class="op">;</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    rawPages<span class="op">.</span><span class="fu">push</span>(<span class="op">...</span>(<span class="cf">await</span> res<span class="op">.</span><span class="fu">json</span>()))<span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>   } <span class="cf">while</span> (followingId)<span class="op">;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>(rawPages<span class="op">.</span><span class="fu">map</span>(p <span class="kw">=&gt;</span> [p<span class="op">.</span><span class="at">title</span><span class="op">,</span> p<span class="op">.</span><span class="at">links</span>]))<span class="op">;</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<ul>
<li>うー、軽く見たけど、頭追いつかん感じ
<ul>
<li>アルゴリズム系は大体こうなる
<ul>
<li>というか久々すぎてｗ</li>
<li>だいぶ鈍ってるな
<ul>
<li>まあ<a href="SIer.md">SIer</a>だもんね……</li>
<li>コード書く場合も一人でつくっておしまいのパターンばかりやもん</li>
</ul></li>
<li>これでも全盛期の頃は脳内でどんどん構造を再現してシミュレートできてたんや……</li>
</ul></li>
<li>が、いけないことはない:sta:
<ul>
<li>俺もエンジニア名乗るならこれくらいサクッと読めなきゃダメンゴよ</li>
</ul></li>
</ul></li>
<li>次やるときの戦略
<ul>
<li>ガチで机上トレースして書きながら見ていくか、デバッグ実行で変数の値見ながらするかしないとダメそう</li>
<li>あとローカルでVSCodeとか使って置換使いながら<a href="机上リファクタリング.md">机上リファクタリング</a>した方がいい
<ul>
<li>Scrapbox上でコード書くのはきっちい</li>
</ul></li>
<li>先にデータ構造全部洗い出して、名前付け直す
<ul>
<li>predは、わからんならテキトーに名前つけなおす</li>
<li>捕食する、的な意味っぽい？
<ul>
<li><a href="https://eow.alc.co.jp/search?q=pred&amp;ref=sa" class="uri">https://eow.alc.co.jp/search?q=pred&amp;ref=sa</a></li>
<li>経路たどることを「捕食する」とたとえているのだろう</li>
</ul></li>
<li>prevのtypoっぽい？</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<h2 id="hop-links">2hop Links</h2>
<ul>
<li>→ <a href="1.md">1</a>
<ul>
<li>← <a href="PythonでinlineのScrapbox記法をMarkdown記法に変換する正規表現.md">PythonでinlineのScrapbox記法をMarkdown記法に変換する正規表現</a></li>
<li>← <a href="isTaskPageの残骸.md">isTaskPageの残骸</a></li>
<li>← <a href="カクヨムに書いた小説を_KDP_で出版する.md">カクヨムに書いた小説を KDP で出版する</a></li>
</ul></li>
<li>→ <a href="SIer.md">SIer</a>
<ul>
<li>← <a href="プロフィール.md">プロフィール</a></li>
<li>← <a href="「部下のメンタル不調」を見抜く3つのサイン.md">「部下のメンタル不調」を見抜く3つのサイン</a></li>
<li>← <a href="知的生産で食べていきたい.md">知的生産で食べていきたい</a></li>
</ul></li>
</ul>
